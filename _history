{"entries":[{"timestamp":1767286567223,"editorVersion":"2.0.63","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":0,"length1":131,"diffs":[[1,"<xml xmlns=\"http://www.w3.org/1999/xhtml\">\n  <variables></variables>\n  <block type=\"pxt-on-start\" x=\"0\" y=\"0\"></block>\n</xml>"]]}]},{"type":"edited","filename":"main.ts","patch":[{"start1":0,"length1":4955,"diffs":[[1," "]]}]},{"type":"edited","filename":"pxt.json","patch":[{"start1":185,"length1":41,"diffs":[[1,"        \"assets.json\"\n"]]},{"start1":214,"length1":31,"diffs":[[1,"    \"additionalFilePaths\": []\n"]]}]},{"type":"added","filename":"main.py","value":"# 1. STATE & CONSTANTS\nlevel = 1\nlauncher_angle = 90\nis_moving = False\ncurrent_bubble: Sprite = None\nCOLORS = [2, 4, 5, 7, 8, 9]\nnext_color = Math.pick_random(COLORS)\n\n# 2. SPRITE DEFINITIONS\n# Launcher is a 32x32 canvas for dynamic drawing\nlauncher = sprites.create(image.create(32, 32), SpriteKind.player)\nlauncher.set_position(80, 110)\n\nnext_bubble_preview = sprites.create(img(\"\"\"\n    . . 7 7 7 7 7 . .\n    . 7 f f f f f 7 .\n    7 f f f f f f f 7\n    7 f f f f f f f 7\n    7 f f f f f f f 7\n    7 f f f f f f f 7\n    7 f f f f f f f 7\n    . 7 f f f f f 7 .\n    . . 7 7 7 7 7 . .\n\"\"\"), SpriteKind.player)\nnext_bubble_preview.set_position(20, 110)\n\n# 3. HELPER FUNCTIONS\ndef get_pos_x(r: number, c: number):\n    x_off = 8 if (r % 2 == 1) else 0\n    return c * 16 + 24 + x_off\n\ndef get_pos_y(r: number, c: number):\n    return r * 14 + 12\n\ndef draw_launcher():\n    global launcher_angle\n    # Clear and redraw the line representing the gun barrel\n    launcher.image.fill(0)\n    rad = launcher_angle * (Math.PI / 180)\n    # Draw from center (16, 16) to the calculated tip\n    x2 = 16 - Math.cos(rad) * 15\n    y2 = 16 - Math.sin(rad) * 15\n    launcher.image.draw_line(16, 16, x2, y2, 1) # 1 = White\n    launcher.image.fill_rect(14, 14, 4, 4, 1) # Base block\n\ndef update_previews():\n    global next_color\n    next_bubble_preview.image.replace(15, next_color)\n    draw_launcher()\n\n# 4. GAME LOGIC\ndef start_level(lvl: number):\n    global level\n    sprites.destroy_all_sprites_of_kind(SpriteKind.enemy)\n    max_rows = min(3 + Math.floor(lvl / 10), 6)\n    \n    for r in range(max_rows):\n        for c in range(8):\n            if Math.percent_chance(90 - lvl):\n                b = sprites.create(img(\"\"\"\n                    . . 7 7 7 7 7 . .\n                    . 7 f f f f f 7 .\n                    7 f f f f f f f 7\n                    7 f f f f f f f 7\n                    7 f f f f f f f 7\n                    7 f f f f f f f 7\n                    7 f f f f f f f 7\n                    . 7 f f f f f 7 .\n                    . . 7 7 7 7 7 . .\n                \"\"\"), SpriteKind.enemy)\n                b.set_position(get_pos_x(r, c), get_pos_y(r, c))\n                b.image.replace(15, Math.pick_random(COLORS))\n    update_previews()\n\ndef handle_collision():\n    global is_moving, level, current_bubble, next_color\n    is_moving = False\n    # Grid snapping\n    grid_x = Math.round((current_bubble.x - 24) / 16) * 16 + 24\n    grid_y = Math.round((current_bubble.y - 12) / 14) * 14 + 12\n    current_bubble.set_position(grid_x, grid_y)\n    current_bubble.set_kind(SpriteKind.enemy)\n    current_bubble.set_velocity(0, 0)\n    music.play(music.melody_playable(music.ba_ding), music.PlaybackMode.IN_BACKGROUND)\n    \n    if len(sprites.all_of_kind(SpriteKind.enemy)) == 0:\n        level += 1\n        game.show_long_text(\"Level \" + str(level), DialogLayout.BOTTOM)\n        start_level(level)\n\n# 5. INPUTS\ndef move_left():\n    global launcher_angle\n    launcher_angle = max(10, launcher_angle - 8)\n    draw_launcher()\n\ndef move_right():\n    global launcher_angle\n    launcher_angle = min(170, launcher_angle + 8)\n    draw_launcher()\n\ndef on_a_pressed():\n    global is_moving, current_bubble, next_color, launcher_angle\n    if not is_moving:\n        is_moving = True\n        music.play(music.melody_playable(music.pew_pew), music.PlaybackMode.IN_BACKGROUND)\n        current_bubble = sprites.create(img(\"\"\"\n            . . 7 7 7 7 7 . .\n            . 7 f f f f f 7 .\n            7 f f f f f f f 7\n            7 f f f f f f f 7\n            7 f f f f f f f 7\n            7 f f f f f f f 7\n            7 f f f f f f f 7\n            . 7 f f f f f 7 .\n            . . 7 7 7 7 7 . .\n        \"\"\"), SpriteKind.projectile)\n        current_bubble.image.replace(15, next_color)\n        current_bubble.set_position(80, 110)\n        rad = launcher_angle * (Math.PI / 180)\n        current_bubble.vx = -Math.cos(rad) * 140\n        current_bubble.vy = -Math.sin(rad) * 140\n        next_color = Math.pick_random(COLORS)\n        update_previews()\n\ncontroller.left.on_event(ControllerButtonEvent.PRESSED, move_left)\ncontroller.left.on_event(ControllerButtonEvent.REPEATED, move_left)\ncontroller.right.on_event(ControllerButtonEvent.PRESSED, move_right)\ncontroller.right.on_event(ControllerButtonEvent.REPEATED, move_right)\ncontroller.A.on_event(ControllerButtonEvent.PRESSED, on_a_pressed)\n\n# 6. UPDATE LOOP\ndef on_update():\n    global is_moving, current_bubble\n    if is_moving and current_bubble:\n        if current_bubble.x <= 8 or current_bubble.x >= 152:\n            current_bubble.vx *= -1\n        if current_bubble.y <= 8:\n            handle_collision()\n        for enemy in sprites.all_of_kind(SpriteKind.enemy):\n            if current_bubble.overlaps_with(enemy):\n                handle_collision()\n                break\n\ngame.on_update(on_update)\n\n# 7. START\nstart_level(1)"}]},{"timestamp":1767287144027,"editorVersion":"2.0.63","changes":[{"type":"edited","filename":"main.ts","patch":[{"start1":85,"length1":24,"diffs":[[1,""]]},{"start1":193,"length1":43,"diffs":[[1,""]]},{"start1":219,"length1":19,"diffs":[[1,"//  Launcher is a 32x32 canvas for dynamic drawing\n"]]},{"start1":371,"length1":316,"diffs":[[1,"let next_bubble_preview = sprites.create(img`\n    . . 7 7 7 7 7 . .\n    . 7 f f f f f 7 .\n    7 f f f f f f f 7\n    7 f f f f f f f 7\n    7 f f f f f f f 7\n    7 f f f f f f f 7\n    7 f f f f f f f 7\n    . 7 f f f f f 7 .\n    . . 7 7 7 7 7 . .\n`, SpriteKind.Player)\n"]]},{"start1":873,"length1":23,"diffs":[[1,"    return r * 14 + 12\n"]]},{"start1":931,"length1":0,"diffs":[[1,"    //  Clear and redraw the line representing the gun barrel\n"]]},{"start1":1067,"length1":20,"diffs":[[1,"    //  Draw from center (16, 16) to the calculated tip\n"]]},{"start1":1244,"length1":0,"diffs":[[1,"    //  1 = White\n"]]},{"start1":1310,"length1":226,"diffs":[[1,"//  Base block\n"]]},{"start1":1359,"length1":208,"diffs":[[1,"    next_bubble_preview.image.replace(15, next_color)\n"]]},{"start1":1514,"length1":23,"diffs":[[1,""]]},{"start1":1568,"length1":122,"diffs":[[1,"    let max_rows = Math.min(3 + Math.floor(lvl / 10), 6)\n"]]},{"start1":1752,"length1":97,"diffs":[[1,"                b = sprites.create(img`\n                    . . 7 7 7 7 7 . .\n                    . 7 f f f f f 7 .\n                    7 f f f f f f f 7\n                    7 f f f f f f f 7\n                    7 f f f f f f f 7\n                    7 f f f f f f f 7\n                    7 f f f f f f f 7\n                    . 7 f f f f f 7 .\n                    . . 7 7 7 7 7 . .\n                `, SpriteKind.Enemy)\n"]]},{"start1":2235,"length1":0,"diffs":[[1,"                b.image.replace(15, Math.pickRandom(COLORS))\n"]]},{"start1":2364,"length1":243,"diffs":[[1,""]]},{"start1":2421,"length1":260,"diffs":[[1,"    //  Grid snapping\n    let grid_x = Math.round((current_bubble.x - 24) / 16) * 16 + 24\n    let grid_y = Math.round((current_bubble.y - 12) / 14) * 14 + 12\n    current_bubble.setPosition(grid_x, grid_y)\n"]]},{"start1":2708,"length1":87,"diffs":[[1,""]]},{"start1":3020,"length1":120,"diffs":[[1,""]]},{"start1":3025,"length1":0,"diffs":[[1,"    launcher_angle = Math.max(10, launcher_angle - 8)\n    draw_launcher()\n"]]},{"start1":3126,"length1":121,"diffs":[[1,""]]},{"start1":3131,"length1":0,"diffs":[[1,"    launcher_angle = Math.min(170, launcher_angle + 8)\n    draw_launcher()\n"]]},{"start1":3583,"length1":73,"diffs":[[1,""]]},{"start1":3718,"length1":131,"diffs":[[1,"        current_bubble = sprites.create(img`\n            . . 7 7 7 7 7 . .\n            . 7 f f f f f 7 .\n            7 f f f f f f f 7\n            7 f f f f f f f 7\n            7 f f f f f f f 7\n            7 f f f f f f f 7\n            7 f f f f f f f 7\n            . 7 f f f f f 7 .\n            . . 7 7 7 7 7 . .\n        `, SpriteKind.Projectile)\n        current_bubble.image.replace(15, next_color)\n"]]},{"start1":4164,"length1":159,"diffs":[[1,""]]},{"start1":4309,"length1":0,"diffs":[[1,"        next_color = Math.pickRandom(COLORS)\n"]]},{"start1":4455,"length1":50,"diffs":[[1,""]]}]},{"type":"edited","filename":"main.py","patch":[{"start1":71,"length1":20,"diffs":[[1,""]]},{"start1":167,"length1":40,"diffs":[[1,""]]},{"start1":192,"length1":17,"diffs":[[1,"# Launcher is a 32x32 canvas for dynamic drawing\n"]]},{"start1":340,"length1":306,"diffs":[[1,"next_bubble_preview = sprites.create(img(\"\"\"\n    . . 7 7 7 7 7 . .\n    . 7 f f f f f 7 .\n    7 f f f f f f f 7\n    7 f f f f f f f 7\n    7 f f f f f f f 7\n    7 f f f f f f f 7\n    7 f f f f f f f 7\n    . 7 f f f f f 7 .\n    . . 7 7 7 7 7 . .\n\"\"\"), SpriteKind.player)\n"]]},{"start1":816,"length1":23,"diffs":[[1,"    return r * 14 + 12\n"]]},{"start1":887,"length1":0,"diffs":[[1,"    # Clear and redraw the line representing the gun barrel\n"]]},{"start1":1017,"length1":18,"diffs":[[1,"    # Draw from center (16, 16) to the calculated tip\n"]]},{"start1":1137,"length1":94,"diffs":[[1,"    launcher.image.draw_line(16, 16, x2, y2, 1) # 1 = White\n    launcher.image.fill_rect(14, 14, 4, 4, 1) # Base block\n"]]},{"start1":1257,"length1":203,"diffs":[[1,""]]},{"start1":1280,"length1":240,"diffs":[[1,"    global next_color\n    next_bubble_preview.image.replace(15, next_color)\n"]]},{"start1":1423,"length1":53,"diffs":[[1,"    global level\n"]]},{"start1":1498,"length1":111,"diffs":[[1,"    max_rows = min(3 + Math.floor(lvl / 10), 6)\n"]]},{"start1":1654,"length1":98,"diffs":[[1,"                b = sprites.create(img(\"\"\"\n                    . . 7 7 7 7 7 . .\n                    . 7 f f f f f 7 .\n                    7 f f f f f f f 7\n                    7 f f f f f f f 7\n                    7 f f f f f f f 7\n                    7 f f f f f f f 7\n                    7 f f f f f f f 7\n                    . 7 f f f f f 7 .\n                    . . 7 7 7 7 7 . .\n                \"\"\"), SpriteKind.enemy)\n"]]},{"start1":2144,"length1":0,"diffs":[[1,"                b.image.replace(15, Math.pick_random(COLORS))\n"]]},{"start1":2229,"length1":252,"diffs":[[1,""]]},{"start1":2253,"length1":70,"diffs":[[1,"    global is_moving, level, current_bubble, next_color\n"]]},{"start1":2331,"length1":263,"diffs":[[1,"    # Grid snapping\n    grid_x = Math.round((current_bubble.x - 24) / 16) * 16 + 24\n    grid_y = Math.round((current_bubble.y - 12) / 14) * 14 + 12\n    current_bubble.set_position(grid_x, grid_y)\n"]]},{"start1":2611,"length1":79,"diffs":[[1,""]]},{"start1":2907,"length1":127,"diffs":[[1,"    global launcher_angle\n    launcher_angle = max(10, launcher_angle - 8)\n    draw_launcher()\n"]]},{"start1":3021,"length1":128,"diffs":[[1,"    global launcher_angle\n    launcher_angle = min(170, launcher_angle + 8)\n    draw_launcher()\n"]]},{"start1":3138,"length1":155,"diffs":[[1,"    global is_moving, current_bubble, next_color, launcher_angle\n"]]},{"start1":3341,"length1":138,"diffs":[[1,"        current_bubble = sprites.create(img(\"\"\"\n            . . 7 7 7 7 7 . .\n            . 7 f f f f f 7 .\n            7 f f f f f f f 7\n            7 f f f f f f f 7\n            7 f f f f f f f 7\n            7 f f f f f f f 7\n            7 f f f f f f f 7\n            . 7 f f f f f 7 .\n            . . 7 7 7 7 7 . .\n        \"\"\"), SpriteKind.projectile)\n        current_bubble.image.replace(15, next_color)\n"]]},{"start1":3794,"length1":174,"diffs":[[1,""]]},{"start1":3939,"length1":9,"diffs":[[1,"        next_color = Math.pick_random(COLORS)\n"]]},{"start1":4388,"length1":90,"diffs":[[1,"    global is_moving, current_bubble\n"]]},{"start1":4559,"length1":9,"diffs":[[1,""]]},{"start1":4624,"length1":9,"diffs":[[1,""]]},{"start1":4832,"length1":15,"diffs":[[1,"start_level(1)"]]}]}]},{"timestamp":1767287734448,"editorVersion":"2.0.63","changes":[{"type":"edited","filename":"main.ts","patch":[{"start1":286,"length1":0,"diffs":[[1,"//  Launcher (Gun)\n"]]},{"start1":406,"length1":0,"diffs":[[1,"//  The bubble currently \"inside\" the gun ready to shoot\n"]]},{"start1":588,"length1":0,"diffs":[[1,"//  The \"Next\" bubble in the pipeline (Bottom Left)\n"]]},{"start1":1090,"length1":0,"diffs":[[1,"    //  Barrel line\n"]]},{"start1":1446,"length1":0,"diffs":[[1,"    //  White outline for roundness\n"]]},{"start1":1539,"length1":131,"diffs":[[1,"    //  Update pipeline bubble\n    next_bubble_preview.image = create_bubble_img(next_color)\n    //  Update loaded bubble (the one at the gun)\n    loaded_bubble_sprite.image = create_bubble_img(loaded_color)\n"]]},{"start1":1770,"length1":216,"diffs":[[1,"//  4. GAME LOGIC\nfunction start_level(lvl: number) {\n"]]},{"start1":1843,"length1":868,"diffs":[[1,"    \n    game_active = true\n    sprites.destroyAllSpritesOfKind(SpriteKind.Enemy)\n    //  Starts with exactly 2 rows for early levels as requested\n    let max_rows = Math.min(2 + Math.floor(lvl / 15), 6)\n    for (let r = 0; r < max_rows; r++) {\n        for (let c = 0; c < 8; c++) {\n            if (Math.percentChance(90 - lvl)) {\n                b = sprites.create(create_bubble_img(Math.pickRandom(COLORS)), SpriteKind.Enemy)\n                b.setPosition(get_pos_x(r, c), get_pos_y(r, c))\n"]]},{"start1":2378,"length1":185,"diffs":[[1,"    update_previews()\n"]]},{"start1":2403,"length1":18,"diffs":[[1,""]]},{"start1":2484,"length1":71,"diffs":[[1,"    if (current_bubble) {\n        current_bubble.destroy()\n    }\n    \n    game.showLongText(\"GAME OVER! A to Restart\", DialogLayout.Center)\n"]]},{"start1":2676,"length1":57,"diffs":[[1,""]]},{"start1":2703,"length1":0,"diffs":[[1,"    //  Hex Snap Math\n"]]},{"start1":2780,"length1":104,"diffs":[[1,"    let col_offset = row % 2 == 1 ? 8 : 0\n    let col = Math.round((current_bubble.x - 24 - col_offset) / 16)\n"]]},{"start1":3045,"length1":999,"diffs":[[1,""]]},{"start1":3132,"length1":0,"diffs":[[1,"    music.play(music.melodyPlayable(music.baDing), music.PlaybackMode.InBackground)\n"]]},{"start1":3294,"length1":0,"diffs":[[1,"        game.showLongText(\"Level \" + (\"\" + level), DialogLayout.Bottom)\n"]]},{"start1":3407,"length1":46,"diffs":[[1,"//  5. INPUTS\nfunction move_left() {\n    if (game_active) {\n        \n        launcher_angle = Math.max(10, launcher_angle - 8)\n        draw_launcher()\n    }\n"]]},{"start1":3569,"length1":81,"diffs":[[1,""]]},{"start1":3572,"length1":25,"diffs":[[1,"function move_right() {\n    if (game_active) {\n        \n        launcher_angle = Math.min(170, launcher_angle + 8)\n        draw_launcher()\n    }\n"]]},{"start1":3722,"length1":81,"diffs":[[1,""]]},{"start1":3725,"length1":274,"diffs":[[1,"controller.left.onEvent(ControllerButtonEvent.Pressed, move_left)\ncontroller.left.onEvent(ControllerButtonEvent.Repeated, move_left)\ncontroller.right.onEvent(ControllerButtonEvent.Pressed, move_right)\ncontroller.right.onEvent(ControllerButtonEvent.Repeated, move_right)\n"]]},{"start1":4219,"length1":0,"diffs":[[1,"        music.play(music.melodyPlayable(music.pewPew), music.PlaybackMode.InBackground)\n        //  Fire the loaded bubble\n"]]},{"start1":4482,"length1":0,"diffs":[[1,"        //  Pull the next bubble from pipeline into the gun\n"]]},{"start1":4621,"length1":0,"diffs":[[1,"        //  Physics\n"]]},{"start1":4688,"length1":98,"diffs":[[1,"        current_bubble.vx = -Math.cos(rad) * 140\n        current_bubble.vy = -Math.sin(rad) * 140\n"]]},{"start1":4826,"length1":17,"diffs":[[1,"//  6. UPDATE LOOP\n"]]},{"start1":4882,"length1":31,"diffs":[[1,""]]},{"start1":4887,"length1":54,"diffs":[[1,"    if (!game_active) {\n        return\n    }\n    \n    if (is_moving && current_bubble) {\n"]]},{"start1":5163,"length1":335,"diffs":[[1,""]]},{"start1":5182,"length1":542,"diffs":[[1,"        for (let enemy of sprites.allOfKind(SpriteKind.Enemy)) {\n            if (current_bubble.overlapsWith(enemy)) {\n                handle_collision()\n                break\n"]]},{"start1":5401,"length1":25,"diffs":[[1,"    \n})\n//  7. START\n"]]}]},{"type":"edited","filename":"main.py","patch":[{"start1":121,"length1":1,"diffs":[[1,""]]},{"start1":252,"length1":0,"diffs":[[1,"# Launcher (Gun)\n"]]},{"start1":368,"length1":0,"diffs":[[1,"# The bubble currently \"inside\" the gun ready to shoot\n"]]},{"start1":546,"length1":0,"diffs":[[1,"# The \"Next\" bubble in the pipeline (Bottom Left)\n"]]},{"start1":1023,"length1":0,"diffs":[[1,"    # Barrel line\n"]]},{"start1":1317,"length1":37,"diffs":[[1,"    temp_img.draw_circle(8, 8, 7, 1) # White outline for roundness\n"]]},{"start1":1464,"length1":133,"diffs":[[1,"    # Update pipeline bubble\n    next_bubble_preview.image = create_bubble_img(next_color)\n    # Update loaded bubble (the one at the gun)\n    loaded_bubble_sprite.image = create_bubble_img(loaded_color)\n"]]},{"start1":1689,"length1":319,"diffs":[[1,"# 4. GAME LOGIC\ndef start_level(lvl: number):\n    global level, game_active\n    game_active = True\n    sprites.destroy_all_sprites_of_kind(SpriteKind.enemy)\n    # Starts with exactly 2 rows for early levels as requested\n    max_rows = min(2 + Math.floor(lvl / 15), 6)\n"]]},{"start1":1962,"length1":723,"diffs":[[1,"    for r in range(max_rows):\n        for c in range(8):\n            if Math.percent_chance(90 - lvl):\n                b = sprites.create(create_bubble_img(Math.pick_random(COLORS)), SpriteKind.enemy)\n                b.set_position(get_pos_x(r, c), get_pos_y(r, c))\n    update_previews()\n"]]},{"start1":2251,"length1":16,"diffs":[[1,""]]},{"start1":2275,"length1":41,"diffs":[[1,"    global game_active, is_moving\n"]]},{"start1":2355,"length1":73,"diffs":[[1,"    if current_bubble:\n        current_bubble.destroy()\n    game.show_long_text(\"GAME OVER! A to Restart\", DialogLayout.CENTER)\n"]]},{"start1":2624,"length1":0,"diffs":[[1,"    # Hex Snap Math\n"]]},{"start1":2695,"length1":176,"diffs":[[1,"    col_offset = 8 if (row % 2 == 1) else 0\n    col = Math.round((current_bubble.x - 24 - col_offset) / 16)\n"]]},{"start1":2808,"length1":0,"diffs":[[1,"    current_bubble.set_position(get_pos_x(row, col), get_pos_y(row, col))\n"]]},{"start1":2971,"length1":869,"diffs":[[1,""]]},{"start1":3045,"length1":0,"diffs":[[1,"    music.play(music.melody_playable(music.ba_ding), music.PlaybackMode.IN_BACKGROUND)\n    \n"]]},{"start1":3212,"length1":0,"diffs":[[1,"        game.show_long_text(\"Level \" + str(level), DialogLayout.BOTTOM)\n"]]},{"start1":3312,"length1":145,"diffs":[[1,"# 5. INPUTS\ndef move_left():\n    if game_active:\n        global launcher_angle\n        launcher_angle = max(10, launcher_angle - 8)\n        draw_launcher()\n"]]},{"start1":3469,"length1":126,"diffs":[[1,"def move_right():\n    if game_active:\n        global launcher_angle\n        launcher_angle = min(170, launcher_angle + 8)\n        draw_launcher()\n"]]},{"start1":3790,"length1":0,"diffs":[[1,"\n"]]},{"start1":3838,"length1":0,"diffs":[[1,"        music.play(music.melody_playable(music.pew_pew), music.PlaybackMode.IN_BACKGROUND)\n        \n        # Fire the loaded bubble\n"]]},{"start1":4112,"length1":0,"diffs":[[1,"        \n        # Pull the next bubble from pipeline into the gun\n"]]},{"start1":4259,"length1":0,"diffs":[[1,"        \n        # Physics\n"]]},{"start1":4333,"length1":98,"diffs":[[1,"        current_bubble.vx = -Math.cos(rad) * 140\n        current_bubble.vy = -Math.sin(rad) * 140\n        \n"]]},{"start1":4467,"length1":278,"diffs":[[1,"controller.left.on_event(ControllerButtonEvent.PRESSED, move_left)\ncontroller.left.on_event(ControllerButtonEvent.REPEATED, move_left)\ncontroller.right.on_event(ControllerButtonEvent.PRESSED, move_right)\ncontroller.right.on_event(ControllerButtonEvent.REPEATED, move_right)\n"]]},{"start1":4809,"length1":15,"diffs":[[1,"# 6. UPDATE LOOP\n"]]},{"start1":4893,"length1":53,"diffs":[[1,"    if not game_active:\n        return\n\n    if is_moving and current_bubble:\n"]]},{"start1":5067,"length1":0,"diffs":[[1,"        \n"]]},{"start1":5141,"length1":262,"diffs":[[1,"        \n        for enemy in sprites.all_of_kind(SpriteKind.enemy):\n            if current_bubble.overlaps_with(enemy):\n                handle_collision()\n                break\n\n"]]},{"start1":5347,"length1":534,"diffs":[[1,"# 7. START\nstart_level(1)\n"]]}]}]},{"timestamp":1767288212349,"editorVersion":"2.0.63","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":0,"length1":84,"diffs":[[1,"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables></variables><block type=\"pxt-on-start\" x=\"0\" y=\"0\"></block></xml>"]]}]},{"type":"edited","filename":"main.ts","patch":[{"start1":710,"length1":44,"diffs":[[1,""]]},{"start1":1509,"length1":27,"diffs":[[1,"//  4. ANIMATION & CLEANUP (Fixed for single-variable iteration)\n"]]},{"start1":1957,"length1":0,"diffs":[[1,"    //  FIXED: Using range for iteration\n"]]},{"start1":2242,"length1":43,"diffs":[[1,""]]},{"start1":2861,"length1":601,"diffs":[[1,""]]},{"start1":2999,"length1":0,"diffs":[[1,"    level = 1\n"]]},{"start1":3463,"length1":0,"diffs":[[1,"    //  Flood Fill logic using index-based loops\n"]]},{"start1":4608,"length1":31,"diffs":[[1,"        level += 1\n        start_level(level)\n"]]},{"start1":5191,"length1":105,"diffs":[[1,"controller.A.onEvent(ControllerButtonEvent.Pressed, function on_a_pressed() {\n"]]},{"start1":5415,"length1":88,"diffs":[[1,""]]},{"start1":5819,"length1":194,"diffs":[[1,""]]},{"start1":6531,"length1":0,"diffs":[[1,"function start_level(lvl: number) {\n    let b: Sprite;\n    \n    game_active = true\n    sprites.destroyAllSpritesOfKind(SpriteKind.Enemy)\n    //  Start with 2 rows as requested\n    let max_rows = Math.min(2 + Math.floor(lvl / 10), 5)\n    for (let r = 0; r < max_rows; r++) {\n        for (let c = 0; c < 8; c++) {\n            if (Math.percentChance(85)) {\n                b = sprites.create(create_bubble_img(Math.pickRandom(COLORS)), SpriteKind.Enemy)\n                b.setPosition(get_pos_x(r, c), get_pos_y(r, c))\n            }\n            \n        }\n    }\n    update_previews()\n}\n\n"]]}]},{"type":"edited","filename":"pxt.json","patch":[{"start1":233,"length1":44,"diffs":[[1,""]]}]},{"type":"edited","filename":"main.py","patch":[{"start1":655,"length1":42,"diffs":[[1,""]]},{"start1":1449,"length1":25,"diffs":[[1,"# 4. ANIMATION & CLEANUP (Fixed for single-variable iteration)\n"]]},{"start1":1773,"length1":0,"diffs":[[1,"    # FIXED: Using range for iteration\n"]]},{"start1":1998,"length1":62,"diffs":[[1,"        curr = queue.shift()\n"]]},{"start1":2513,"length1":539,"diffs":[[1,""]]},{"start1":2537,"length1":34,"diffs":[[1,"    global game_active, is_moving, level\n"]]},{"start1":2683,"length1":0,"diffs":[[1,"    level = 1\n"]]},{"start1":2741,"length1":44,"diffs":[[1,"    global is_moving, level, current_bubble, loaded_color, next_color\n"]]},{"start1":3065,"length1":0,"diffs":[[1,"    \n"]]},{"start1":3159,"length1":0,"diffs":[[1,"    # Flood Fill logic using index-based loops\n"]]},{"start1":4158,"length1":31,"diffs":[[1,"        level += 1\n        start_level(level)\n"]]},{"start1":4478,"length1":20,"diffs":[[1,"def on_a_pressed():\n"]]},{"start1":4699,"length1":91,"diffs":[[1,""]]},{"start1":5092,"length1":88,"diffs":[[1,""]]},{"start1":5370,"length1":0,"diffs":[[1,"controller.A.on_event(ControllerButtonEvent.PRESSED, on_a_pressed)\n"]]},{"start1":5438,"length1":200,"diffs":[[1,""]]},{"start1":5997,"length1":1,"diffs":[[1,""]]},{"start1":6035,"length1":15,"diffs":[[1,"def start_level(lvl: number):\n    global level, game_active\n    game_active = True\n    sprites.destroy_all_sprites_of_kind(SpriteKind.enemy)\n    # Start with 2 rows as requested\n    max_rows = min(2 + Math.floor(lvl / 10), 5)\n    for r in range(max_rows):\n        for c in range(8):\n            if Math.percent_chance(85):\n                b = sprites.create(create_bubble_img(Math.pick_random(COLORS)), SpriteKind.enemy)\n                b.set_position(get_pos_x(r, c), get_pos_y(r, c))\n    update_previews()\n\nstart_level(1)"]]}]},{"type":"added","filename":"test.ts","value":"// tests go here; this will not be compiled when this package is used as an extension.\n"}]}],"snapshots":[{"timestamp":1767286567222,"editorVersion":"2.0.63","text":{"main.blocks":"<xml xmlns=\"http://www.w3.org/1999/xhtml\">\n  <variables></variables>\n  <block type=\"pxt-on-start\" x=\"0\" y=\"0\"></block>\n</xml>","main.ts":" ","README.md":" ","assets.json":"","pxt.json":"{\n    \"name\": \"bust-a-move-big\",\n    \"description\": \"\",\n    \"dependencies\": {\n        \"device\": \"*\"\n    },\n    \"files\": [\n        \"main.blocks\",\n        \"main.ts\",\n        \"README.md\",\n        \"assets.json\"\n    ],\n    \"additionalFilePaths\": []\n}\n"}},{"timestamp":1767288501376,"editorVersion":"2.0.63","text":{"main.blocks":"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables></variables><block type=\"pxt-on-start\" x=\"0\" y=\"0\"></block></xml>","main.ts":"","README.md":" ","assets.json":"","main.py":"# 1. STATE & CONSTANTS\nlevel = 1\nlauncher_angle = 90\nis_moving = False\ngame_active = False\ncurrent_bubble: Sprite = None\n\nCOLORS = [2, 4, 5, 7, 8, 9]\nnext_color = Math.pick_random(COLORS)\nloaded_color = Math.pick_random(COLORS)\n\n# 2. SPRITE DEFINITIONS\nlauncher = sprites.create(image.create(32, 32), SpriteKind.player)\nlauncher.set_position(80, 110)\n\nloaded_bubble_sprite = sprites.create(image.create(16, 16), SpriteKind.player)\nloaded_bubble_sprite.set_position(80, 110)\n\nnext_bubble_preview = sprites.create(image.create(16, 16), SpriteKind.player)\nnext_bubble_preview.set_position(20, 110)\n\n# 3. HELPER FUNCTIONS\ndef get_pos_x(r: number, c: number):\n    x_off = 8 if (r % 2 == 1) else 0\n    return c * 16 + 24 + x_off\n\ndef get_pos_y(r: number, c: number):\n    return r * 14 + 10\n\ndef draw_launcher():\n    global launcher_angle\n    launcher.image.fill(0)\n    rad = launcher_angle * (Math.PI / 180)\n    x2 = 16 - Math.cos(rad) * 15\n    y2 = 16 - Math.sin(rad) * 15\n    launcher.image.draw_line(16, 16, x2, y2, 1)\n    launcher.image.fill_rect(14, 14, 4, 4, 1)\n\ndef create_bubble_img(color: number):\n    temp_img = image.create(16, 16)\n    temp_img.fill_circle(8, 8, 7, color)\n    temp_img.draw_circle(8, 8, 7, 1)\n    return temp_img\n\ndef update_previews():\n    global next_color, loaded_color\n    next_bubble_preview.set_image(create_bubble_img(next_color))\n    loaded_bubble_sprite.set_image(create_bubble_img(loaded_color))\n    draw_launcher()\n\n# 4. ANIMATION & CLEANUP (Fixed for single-variable iteration)\ndef drop_bubble(b: Sprite):\n    b.set_kind(SpriteKind.food)\n    b.vy = 100\n    b.ay = 200\n    b.lifespan = 2000\n\ndef clean_up_floating():\n    connected: List[Sprite] = []\n    queue: List[Sprite] = []\n    all_bubbles = sprites.all_of_kind(SpriteKind.enemy)\n    \n    # FIXED: Using range for iteration\n    for i in range(len(all_bubbles)):\n        b = all_bubbles[i]\n        if b.y <= 12:\n            queue.append(b)\n            connected.append(b)\n            \n    while len(queue) > 0:\n        curr = queue.shift()\n        for j in range(len(all_bubbles)):\n            other = all_bubbles[j]\n            if other not in connected:\n                dist = Math.sqrt((curr.x - other.x)**2 + (curr.y - other.y)**2)\n                if dist < 18:\n                    connected.append(other)\n                    queue.append(other)\n                    \n    for k in range(len(all_bubbles)):\n        target = all_bubbles[k]\n        if target not in connected:\n            drop_bubble(target)\n\n# 5. CORE LOGIC\ndef handle_game_over():\n    global game_active, is_moving, level\n    game_active = False\n    is_moving = False\n    game.show_long_text(\"GAME OVER!\", DialogLayout.CENTER)\n    level = 1\n    start_level(1)\n\ndef handle_collision():\n    global is_moving, level, current_bubble, loaded_color, next_color\n    is_moving = False\n    \n    row = Math.round((current_bubble.y - 10) / 14)\n    col_off = 8 if (row % 2 == 1) else 0\n    col = Math.round((current_bubble.x - 24 - col_off) / 16)\n    current_bubble.set_position(get_pos_x(row, col), get_pos_y(row, col))\n    \n    current_bubble.set_kind(SpriteKind.enemy)\n    current_bubble.set_velocity(0, 0)\n    \n    # Flood Fill logic using index-based loops\n    match_color = current_bubble.image.get_pixel(8, 8)\n    matches: List[Sprite] = [current_bubble]\n    m_queue: List[Sprite] = [current_bubble]\n    all_enemies = sprites.all_of_kind(SpriteKind.enemy)\n    \n    while len(m_queue) > 0:\n        c = m_queue.shift()\n        for m_idx in range(len(all_enemies)):\n            o = all_enemies[m_idx]\n            if o not in matches and o.image.get_pixel(8, 8) == match_color:\n                d = Math.sqrt((c.x - o.x)**2 + (c.y - o.y)**2)\n                if d < 18:\n                    matches.append(o)\n                    m_queue.append(o)\n    \n    if len(matches) >= 3:\n        music.play(music.melody_playable(music.ba_ding), music.PlaybackMode.IN_BACKGROUND)\n        for p_idx in range(len(matches)):\n            drop_bubble(matches[p_idx])\n        clean_up_floating()\n    \n    if current_bubble.y > 100:\n        handle_game_over()\n        return\n\n    if len(sprites.all_of_kind(SpriteKind.enemy)) == 0:\n        level += 1\n        start_level(level)\n\n# 6. INPUT HANDLERS\ndef press_left():\n    global launcher_angle\n    launcher_angle = Math.clamp(15, 165, launcher_angle - 8)\n    draw_launcher()\n\ndef press_right():\n    global launcher_angle\n    launcher_angle = Math.clamp(15, 165, launcher_angle + 8)\n    draw_launcher()\n\ndef on_a_pressed():\n    global is_moving, current_bubble, next_color, loaded_color, launcher_angle, game_active\n    if not game_active:\n        start_level(1)\n        return\n    if not is_moving:\n        is_moving = True\n        current_bubble = sprites.create(create_bubble_img(loaded_color), SpriteKind.projectile)\n        current_bubble.set_position(80, 110)\n        loaded_color = next_color\n        next_color = Math.pick_random(COLORS)\n        rad = launcher_angle * (Math.PI / 180)\n        current_bubble.vx = -Math.cos(rad) * 150\n        current_bubble.vy = -Math.sin(rad) * 150\n        update_previews()\n\ncontroller.left.on_event(ControllerButtonEvent.PRESSED, press_left)\ncontroller.left.on_event(ControllerButtonEvent.REPEATED, press_left)\ncontroller.right.on_event(ControllerButtonEvent.PRESSED, press_right)\ncontroller.right.on_event(ControllerButtonEvent.REPEATED, press_right)\ncontroller.A.on_event(ControllerButtonEvent.PRESSED, on_a_pressed)\n\n# 7. GAME LOOP\ndef on_update():\n    global is_moving, current_bubble, game_active\n    if is_moving and current_bubble and game_active:\n        if current_bubble.x <= 8 or current_bubble.x >= 152:\n            current_bubble.vx *= -1\n        if current_bubble.y <= 8:\n            handle_collision()\n        else:\n            all_enemies = sprites.all_of_kind(SpriteKind.enemy)\n            for e_idx in range(len(all_enemies)):\n                if current_bubble.overlaps_with(all_enemies[e_idx]):\n                    handle_collision()\n                    break\ngame.on_update(on_update)\n\n# 8. START\ndef start_level(lvl: number):\n    global level, game_active\n    game_active = True\n    sprites.destroy_all_sprites_of_kind(SpriteKind.enemy)\n    # Start with 2 rows as requested\n    max_rows = min(2 + Math.floor(lvl / 10), 5)\n    for r in range(max_rows):\n        for c in range(8):\n            if Math.percent_chance(85):\n                b = sprites.create(create_bubble_img(Math.pick_random(COLORS)), SpriteKind.enemy)\n                b.set_position(get_pos_x(r, c), get_pos_y(r, c))\n    update_previews()\n\nstart_level(1)","pxt.json":"{\n    \"name\": \"bust-a-move-big\",\n    \"description\": \"\",\n    \"dependencies\": {\n        \"device\": \"*\"\n    },\n    \"files\": [\n        \"main.blocks\",\n        \"main.ts\",\n        \"README.md\",\n        \"assets.json\",\n        \"main.py\"\n    ],\n    \"preferredEditor\": \"pyprj\"\n}\n"}}],"shares":[],"lastSaveTime":1767288547493}